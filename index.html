<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Master Birria POS</title>
  <style>
    :root { --primary: #e63946; --secondary: #457b9d; --bg: #f8f9fa; --card-bg: #ffffff; --accent: #2a9d8f; }
    html, body { margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden; overscroll-behavior-y: contain; user-select: none; -webkit-user-select: none; font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); }
    
    /* ENCABEZADO OPTIMIZADO: LOGO CENTRADO Y BOTONES LARGOS */
    header { 
      background: var(--primary); 
      color: white; 
      padding: 0 10px; 
      display: flex; 
      align-items: center; 
      justify-content: center; /* Centra el contenido */
      height: 110px; 
      position: relative; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      gap: 10px; /* Espacio entre botones y logo */
    }

    .btn-header { 
      flex: 1; /* Esto hace que los botones se estiren y se vean largos */
      padding: 12px 5px; 
      border: none; 
      border-radius: 8px; 
      font-weight: bold; 
      color: white; 
      font-size: 0.8rem; 
      cursor: pointer; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      gap: 5px;
      height: 50px; /* Altura c√≥moda para los botones */
      white-space: nowrap;
    }

    .btn-ver-ventas { background: #333; }
    .btn-ver-pedido { background: var(--secondary); }

    .logo-central {
      height: 95px; /* Logo grande en el centro */
      width: auto;
      flex-shrink: 0; /* Evita que el logo se aplaste */
    }

    .container { padding: 10px; height: calc(100% - 120px); display: flex; flex-direction: column; }
    
    .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(155px, 1fr)); gap: 12px; overflow-y: auto; padding-bottom: 60px; -webkit-overflow-scrolling: touch; }
    
    .card { background: var(--card-bg); border-radius: 12px; padding: 10px; border: 1px solid #eee; height: 320px; display: flex; flex-direction: column; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; overflow: hidden; }
    .card img { width: 100%; height: 85px; object-fit: cover; border-radius: 8px; background: #eee; }
    .card-title { font-size: 0.75rem; font-weight: bold; height: 35px; text-align: center; margin: 5px 0; display: flex; align-items: center; justify-content: center; }
    .card-price { color: var(--primary); font-weight: bold; text-align: center; font-size: 1rem; margin-bottom: 5px; min-height: 1.2rem; }
    .card-options { flex: 1; overflow-y: auto; font-size: 0.7rem; background: #f3f3f3; border-radius: 6px; padding: 5px; }
    .option-row { border-bottom: 1px solid #ddd; padding: 6px 0; }
    .controls { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 5px; }
    .controls button { background: var(--secondary); color: white; border: none; width: 32px; height: 32px; border-radius: 6px; font-weight: bold; font-size: 1.2rem; }

    /* POPUPS (Funcionalidad intacta) */
    .popup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); justify-content: center; align-items: center; z-index: 1000; }
    .popup-content { background: white; padding: 1.5rem; border-radius: 20px; width: 90%; max-width: 380px; position: relative; max-height: 85vh; overflow-y: auto; }
    .invoice-area { border: 1px solid #ccc; padding: 15px; background: white; font-size: 0.9rem; color: #000; border-radius: 5px; margin-bottom: 10px; }
    .close-x { position: absolute; top: 10px; right: 15px; font-size: 2.5rem; border: none; background: none; color: #999; cursor: pointer; }
    
    .input-group { margin-bottom: 10px; }
    .input-label { font-size: 0.75rem; color: #666; font-weight: bold; margin-left: 5px; }
    input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; box-sizing: border-box; margin-top: 4px; }
    
    .payment-radios { display: flex; justify-content: space-between; margin: 10px 0; background: #f0f0f0; padding: 12px; border-radius: 10px; }
    #paymentDetailArea { margin-top: 10px; border-radius: 10px; padding: 15px; font-weight: bold; text-align: center; font-size: 1rem; }
    .pay-yappy { background: #e0f2fe; color: #0369a1; border: 2px solid #0369a1; }
    .pay-efectivo { background: #dcfce7; color: #166534; border: 2px solid #166534; }
    .pay-pendiente { background: #fee2e2; color: #991b1b; border: 2px solid #991b1b; }

    .btn-confirm { background: var(--accent); color: white; border: none; padding: 1.2rem; width: 100%; border-radius: 10px; font-weight: bold; font-size: 1.1rem; margin-top: 10px; }
    
    .venta-item { border-bottom: 1px solid #ddd; padding: 8px 0; display: flex; justify-content: space-between; align-items: center; }
    .btn-pagar { background: #f59e0b; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }

    #toast { visibility: hidden; min-width: 250px; background: #333; color: #fff; text-align: center; border-radius: 8px; padding: 15px; position: fixed; z-index: 2000; left: 50%; bottom: 40px; transform: translateX(-50%); }
    #toast.show { visibility: visible; }
  </style>
</head>
<body>

  <header>
    <button class="btn-header btn-ver-ventas" onclick="abrirHistorial()">üì¶ VENTAS</button>
    <img src="imagenes/logombirria.png" class="logo-central" alt="Logo">
    <button class="btn-header btn-ver-pedido" onclick="generateInvoice()">üõí PEDIDO</button>
  </header>

  <div class="container">
    <div id="dashboard" class="products-grid"></div>
  </div>

  <div class="popup" id="popupPedido">
    <div class="popup-content">
      <button class="close-x" onclick="cancelarPedidoEncerar()">&times;</button>
      <div id="invoice" class="invoice-area"></div>
      
      <div class="input-group">
        <span class="input-label">N√öMERO DE ORDEN</span>
        <input type="number" id="orderNum" placeholder="N¬∞ de Orden" inputmode="numeric">
      </div>
      
      <div class="input-group">
        <span class="input-label">NOMBRE DEL CLIENTE</span>
        <input type="text" id="clientName" placeholder="Ej: Juan P√©rez">
      </div>

      <div class="payment-radios">
        <label><input type="radio" name="payment" value="yappy" onchange="updatePaymentStyle()"> Yappy</label>
        <label><input type="radio" name="payment" value="efectivo" onchange="updatePaymentStyle()"> Efectivo</label>
        <label><input type="radio" name="payment" value="pendiente" onchange="updatePaymentStyle()"> Pend.</label>
      </div>
      <div id="paymentDetailArea" style="display:none;"></div>
      <button class="btn-confirm" onclick="finalizarOrden()">FINALIZAR Y ENVIAR</button>
    </div>
  </div>

  <div class="popup" id="popupHistorial">
    <div class="popup-content">
      <button class="close-x" onclick="document.getElementById('popupHistorial').style.display='none'">&times;</button>
      <h3 id="fechaTituloHistorial" style="text-align:center; margin-top:0; font-size:1rem;">Ventas Guardadas</h3>
      <div id="listaVentas" style="font-size: 0.8rem; max-height: 250px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; background: #fafafa; border-radius: 8px;"></div>
      <div id="resumenCaja" style="margin-top:15px; font-weight:bold; background:#e0f2fe; padding:15px; border-radius:10px; color: #0369a1;"></div>
      <button class="btn-confirm" style="background:var(--secondary);" onclick="copiarReporteCompleto()">üìã COPIAR REPORTE</button>
      <button class="btn-confirm" style="background:#e63946;" onclick="cerrarCaja()">BORRAR TODO EL D√çA</button>
    </div>
  </div>

  <div class="popup" id="popupSeleccionarMetodo">
    <div class="popup-content" style="max-width:300px; text-align:center;">
      <h3 style="margin-top:0;">¬øC√≥mo pag√≥?</h3>
      <p id="infoOrdenPago" style="font-size:0.9rem; color:#666;"></p>
      <div class="pago-selector-btns" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
        <button class="btn-pagar" style="background: #0077ff; padding: 15px; border-radius: 10px; font-size: 0.9rem;" onclick="procesarPagoEstado('yappy')">YAPPY</button>
        <button class="btn-pagar" style="background: #10b981; padding: 15px; border-radius: 10px; font-size: 0.9rem;" onclick="procesarPagoEstado('efectivo')">EFECTIVO</button>
      </div>
      <button onclick="document.getElementById('popupSeleccionarMetodo').style.display='none'" style="margin-top:15px; background:none; border:none; color:gray; text-decoration:underline;">Regresar</button>
    </div>
  </div>

  <div id="toast"></div>

  <script>
    let historialVentas = JSON.parse(localStorage.getItem('ventas_birria')) || [];
    let idVentaPendienteActual = null;
    let currentTotal = 0;

    const products = [
      { id: 1, name: "HAMBURGUESA SENCILLA", price: 4, img: "imagenes/hsimple.png", qty: 0 },
      { id: 2, name: "HAMBURGUESA COMPLETA", price: 6, img: "imagenes/hcompleta.png", qty: 0 },
      { id: 3, name: "CHORIPAN ARGENTINO", price: 5, img: "imagenes/choripan.png", qty: 0 },
      { id: 4, name: "HOT DOG TRADICIONAL", price: 2.5, img: "imagenes/hdtradicional.png", qty: 0 },
      { id: 5, name: "HOT DOG ESPECIAL", price: 3.5, img: "imagenes/hdespecial.png", qty: 0 },
      { id: 6, name: "10 ALITAS GRANDES", price: 10, img: "imagenes/alitas.png", qty: 0 },
      { id: 7, name: "15 ALITAS GRANDES", price: 16.5, img: "imagenes/alitas.png", qty: 0 },
      { id: 8, name: "20 ALITAS GRANDES", price: 20, img: "imagenes/alitas.png", qty: 0 },
      { id: 9, name: "PICADITA PEQUE√ëA", price: 3.5, img: "imagenes/ppeque√±a.png", qty: 0 },
      { id: 10, name: "PICADITA GRANDE", type: "group", img: "imagenes/pgrande.png", options: [{ id: 101, name: "CHORIZO-CARNE", price: 5, qty: 0 }, { id: 102, name: "CHORIZO-ALITAS", price: 5, qty: 0 }, { id: 103, name: "ALITAS-CARNE", price: 5, qty: 0 }] },
      { id: 11, name: "PICADITA FAMILIAR", price: 15, img: "imagenes/pfamiliar.png", qty: 0 },
      { id: 12, name: "SALCHIPAPA", price: 4.5, img: "imagenes/salchipapa.png", qty: 0 },
      { id: 13, name: "ADICIONALES", type: "group", img: "imagenes/extras.png", options: [{ id: 131, name: "Papas", price: 1.5, qty: 0 }, { id: 132, name: "Chorizo", price: 2.5, qty: 0 }, { id: 133, name: "Salsa", price: 0.5, qty: 0 }] }
    ];

    function showToast(msg) { const t = document.getElementById("toast"); t.innerText = msg; t.className = "show"; setTimeout(() => t.className = "", 3000); }

    function renderDashboard() {
      const db = document.getElementById("dashboard"); db.innerHTML = "";
      products.forEach(p => {
        const card = document.createElement("div"); card.className = "card";
        let html = `<img src="${p.img}" onerror="this.style.display='none';"><div class="card-title">${p.name}</div>`;
        if (p.type === "group") {
          html += `<div class="card-price">${p.name === "PICADITA GRANDE" ? "$5.00" : ""}</div><div class="card-options">`;
          p.options.forEach(o => {
            html += `<div class="option-row"><div style="display:flex; justify-content:space-between"><span>${o.name}</span>${p.name === "ADICIONALES" ? "<span>$"+o.price.toFixed(2)+"</span>" : ""}</div>
              <div class="controls"><button onclick="updateQty(${o.id},-1)">-</button><span id="qty-${o.id}">${o.qty}</span><button onclick="updateQty(${o.id},1)">+</button></div></div>`;
          });
          html += `</div>`;
        } else {
          html += `<div class="card-price">$${p.price.toFixed(2)}</div><div class="controls" style="margin-top:auto;"><button onclick="updateQty(${p.id},-1)">-</button><span id="qty-${p.id}">${p.qty}</span><button onclick="updateQty(${p.id},1)">+</button></div>`;
        }
        card.innerHTML = html; db.appendChild(card);
      });
    }

    function updateQty(id, ch) {
      products.forEach(p => {
        if(p.id===id) p.qty = Math.max(0, p.qty+ch);
        else if(p.options){ let o=p.options.find(opt=>opt.id === id); if(o) o.qty=Math.max(0, o.qty+ch); }
      });
      const el = document.getElementById(`qty-${id}`); if(el) el.innerText = getQty(id);
    }

    function getQty(id) {
      let q = 0;
      products.forEach(p => { if(p.id===id) q=p.qty; else if(p.options){ let o=p.options.find(opt=>opt.id===id); if(o) q=o.qty; } });
      return q;
    }

    function updatePaymentStyle() {
      const area = document.getElementById("paymentDetailArea");
      const payEl = document.querySelector('input[name="payment"]:checked');
      if(!payEl) return;
      area.style.display = "block"; area.className = "";
      if (payEl.value === 'yappy') { area.classList.add("pay-yappy"); area.innerHTML = "üì± YAPPY: 61988350"; }
      else if (payEl.value === 'efectivo') { area.classList.add("pay-efectivo"); area.innerHTML = `üíµ EFECTIVO<br><input type="number" id="received" placeholder="¬øCu√°nto recibes?" oninput="calcChange()" style="width:80%; margin:5px auto; display:block;"><span id="chg"></span>`; }
      else { area.classList.add("pay-pendiente"); area.innerHTML = "üö® PAGO PENDIENTE"; }
    }

    function calcChange() {
      const rec = parseFloat(document.getElementById("received").value) || 0;
      const diff = rec - currentTotal;
      document.getElementById("chg").innerText = diff >= 0 ? "CAMBIO: $" + diff.toFixed(2) : "";
    }

    function getNextOrderNumber() {
        if (historialVentas.length === 0) return 1;
        const numeros = historialVentas.map(v => parseInt(v.num)).filter(n => !isNaN(n));
        return numeros.length > 0 ? Math.max(...numeros) + 1 : 1;
    }

    function generateInvoice() {
      const inv = document.getElementById("invoice");
      let total = 0, has = false;
      const now = new Date();
      const fechaActual = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

      let html = `<div style="text-align:center"><strong>MASTER BIRRIA</strong><br><small>${fechaActual}</small></div><hr>`;
      products.forEach(p => {
        if(p.options) p.options.forEach(o => { 
          if(o.qty > 0) { 
            const nombreCompuesto = `${p.name} (${o.name})`;
            html += `<div style="display:flex; justify-content:space-between"><span>${nombreCompuesto} x${o.qty}</span> <span>$${(o.price*o.qty).toFixed(2)}</span></div>`; 
            total += o.price*o.qty; has = true; 
          }
        });
        else if(p.qty > 0) { 
          html += `<div style="display:flex; justify-content:space-between"><span>${p.name} x${p.qty}</span> <span>$${(p.price*p.qty).toFixed(2)}</span></div>`; 
          total += p.price*p.qty; has = true; 
        }
      });
      if(!has) return showToast("‚ö†Ô∏è Selecciona productos primero");
      html += `<hr><div style="text-align:right"><strong>TOTAL: $${total.toFixed(2)}</strong></div>`;
      inv.innerHTML = html; currentTotal = total;
      document.getElementById("orderNum").value = getNextOrderNumber();
      document.getElementById("popupPedido").style.display = "flex";
    }

    function finalizarOrden() {
      const name = document.getElementById("clientName").value.trim();
      const num = document.getElementById("orderNum").value.trim();
      const payEl = document.querySelector('input[name="payment"]:checked');
      
      if(!num || !name) return showToast("‚ùå Faltan datos del cliente");
      if(!payEl) return showToast("‚ö†Ô∏è Selecciona un m√©todo de pago");

      const metodo = payEl.value;
      const recEl = document.getElementById("received");
      const recValue = recEl ? parseFloat(recEl.value) : 0;

      if(metodo === 'efectivo') {
          if(!recEl || !recEl.value || recValue <= 0) return showToast("üíµ Indica cu√°nto recibes");
          if(recValue < currentTotal) return showToast(`‚ùå Falta dinero ($${(currentTotal - recValue).toFixed(2)})`);
      }

      const now = new Date();
      const fechaStr = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      let detalle = "";
      products.forEach(p => {
        if(p.options) p.options.forEach(o => { 
          if(o.qty > 0) {
            const nombreCompuesto = `${p.name} (${o.name})`;
            detalle += `*‚Ä¢* ${nombreCompuesto}\n  ${o.qty} x $${o.price.toFixed(2)} = $${(o.price*o.qty).toFixed(2)}\n`; 
          }
        });
        else if(p.qty > 0) detalle += `*‚Ä¢* ${p.name}\n  ${p.qty} x $${p.price.toFixed(2)} = $${(p.price*p.qty).toFixed(2)}\n`;
      });

      const cambioStr = (metodo === 'efectivo') ? `\nRecibido: $${recValue.toFixed(2)}\nCambio: $${(recValue - currentTotal).toFixed(2)}` : "";
      const texto = `MASTER BIRRIA\nFecha: ${fechaStr}\n----------------------------\nOrden: #${num}\nCliente: ${name.toUpperCase()}\n----------------------------\nDETALLE:\n${detalle}----------------------------\n*TOTAL:* $${currentTotal.toFixed(2)}\nPago: ${metodo.toUpperCase()}${cambioStr}\n\n¬°Gracias por su compra!`;
      
      historialVentas.push({ id: Date.now(), num: parseInt(num), name, total: currentTotal, metodo: metodo, fecha: fechaStr });
      localStorage.setItem('ventas_birria', JSON.stringify(historialVentas));

      const temp = document.createElement("textarea"); temp.value = texto; document.body.appendChild(temp); temp.select(); document.execCommand("copy"); document.body.removeChild(temp);
      window.location.href = `whatsapp://send?text=${encodeURIComponent(texto)}`;

      encerarTodo();
      document.getElementById("popupPedido").style.display = "none";
      showToast("‚úÖ Enviado");
    }

    function encerarTodo() {
      products.forEach(p => { if(p.options) p.options.forEach(o => o.qty = 0); else p.qty = 0; });
      document.getElementById("clientName").value = "";
      document.getElementById("orderNum").value = "";
      document.getElementById("paymentDetailArea").style.display = "none";
      const radioP = document.querySelector('input[name="payment"]:checked');
      if(radioP) radioP.checked = false;
      renderDashboard();
    }

    function cancelarPedidoEncerar() { encerarTodo(); document.getElementById("popupPedido").style.display = "none"; }

    function abrirHistorial() {
      const lista = document.getElementById("listaVentas");
      const res = document.getElementById("resumenCaja");
      const hoy = new Date().toLocaleDateString();
      document.getElementById("fechaTituloHistorial").innerText = `Ventas del ${hoy}`;
      lista.innerHTML = historialVentas.length ? "" : "Sin ventas.";
      let t = 0, y = 0, e = 0, p = 0;
      historialVentas.forEach((v) => {
        const item = document.createElement("div");
        item.className = "venta-item";
        let btnPagar = v.metodo === 'pendiente' ? `<button class="btn-pagar" onclick="mostrarMenuPago(${v.id}, '${v.name}', ${v.total})">Pagar</button>` : "";
        item.innerHTML = `<div><strong>#${v.num}</strong> - ${v.name}<br><span style="color:${v.metodo==='pendiente'?'red':'gray'}">$${v.total.toFixed(2)} (${v.metodo.toUpperCase()})</span></div>${btnPagar}`;
        lista.appendChild(item);
        t += v.total; if(v.metodo === 'yappy') y += v.total; else if(v.metodo === 'efectivo') e += v.total; else p += v.total;
      });
      res.innerHTML = `Efectivo: $${e.toFixed(2)} | Yappy: $${y.toFixed(2)}<br>Pendiente: $${p.toFixed(2)} | TOTAL: $${t.toFixed(2)}`;
      document.getElementById("popupHistorial").style.display = "flex";
    }

    function mostrarMenuPago(id, cliente, total) {
        idVentaPendienteActual = id;
        document.getElementById("infoOrdenPago").innerText = `${cliente} - $${total.toFixed(2)}`;
        document.getElementById("popupSeleccionarMetodo").style.display = "flex";
    }

    function procesarPagoEstado(metodo) {
        historialVentas = historialVentas.map(v => { if(v.id === idVentaPendienteActual) v.metodo = metodo; return v; });
        localStorage.setItem('ventas_birria', JSON.stringify(historialVentas));
        document.getElementById("popupSeleccionarMetodo").style.display = "none";
        abrirHistorial();
        showToast("‚úÖ Pago actualizado");
    }

    function copiarReporteCompleto() {
      if(!historialVentas.length) return;
      let r = `üìã REPORTE MASTER BIRRIA\n------------------\n`;
      let t = 0;
      historialVentas.forEach(v => { r += `#${v.num} | ${v.name} | $${v.total.toFixed(2)} (${v.metodo.toUpperCase()})\n`; t += v.total; });
      r += `------------------\nTOTAL D√çA: $${t.toFixed(2)}`;
      const temp = document.createElement("textarea"); temp.value = r; document.body.appendChild(temp); temp.select(); document.execCommand("copy"); document.body.removeChild(temp);
      showToast("üìã Reporte copiado");
    }

    function cerrarCaja() {
      if(confirm("¬øBorrar todas las ventas y reiniciar contador?")) { 
        historialVentas = []; localStorage.removeItem('ventas_birria'); 
        document.getElementById("popupHistorial").style.display = "none"; 
        showToast("üßπ Caja limpia"); 
      }
    }

    renderDashboard();
  </script>
</body>
</html>